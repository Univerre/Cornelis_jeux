<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mes jeux de sciences</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --ink:#e5e7eb;
    --muted:#94a3b8; --accent:#60a5fa; --ok:#10b981;
    --shadow:0 8px 24px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    color:var(--ink); background:radial-gradient(1200px 600px at 20% -10%, #1e293b 0, #0b1222 60%, #060b15 100%);
    min-height:100svh; display:flex; flex-direction:column;
  }
  header{
    width:min(1100px,96vw); margin:18px auto 8px; padding:0 8px;
  }
  h1{ margin:.2rem 0 .3rem; font-size:clamp(20px,3.5vw,32px) }
  .sub{ margin:0; color:var(--muted) }
  .toolbar{
    margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  }
  .search{
    flex:1 1 300px; display:flex; gap:8px; align-items:center;
    background:rgba(255,255,255,.05); border:1px solid rgba(148,163,184,.25);
    border-radius:12px; padding:8px 10px;
  }
  .search input{
    flex:1; background:transparent; border:none; outline:none; color:var(--ink);
    font-size:16px;
  }
  .grid{
    width:min(1100px,96vw); margin:10px auto 30px; padding:0 8px;
    display:grid; gap:14px;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  }
  .card{
    background:var(--card); border-radius:16px; overflow:hidden; box-shadow:var(--shadow);
    display:flex; flex-direction:column; min-height:300px; border:1px solid rgba(148,163,184,.2);
  }
  .thumb{
    aspect-ratio:16/9; width:100%; background:linear-gradient(135deg, #0ea5e9, #22d3ee);
    display:grid; place-items:center; color:#052033; font-weight:800; font-size:28px;
    letter-spacing:.5px;
  }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
  .body{ padding:12px 12px 8px; display:flex; flex-direction:column; gap:6px; }
  .title{ font-weight:800; font-size:18px; margin:0 }
  .desc{ margin:0; color:var(--muted); font-size:14px; min-height:38px }
  .actions{ display:flex; gap:8px; margin-top:auto; padding:10px 12px 12px }
  .btn{
    appearance:none; border:none; cursor:pointer; font-weight:700; color:var(--ink);
    border-radius:12px; padding:10px 12px; background:#0d1425;
    border:1px solid rgba(148,163,184,.28);
  }
  .btn.primary{ border-color:rgba(96,165,250,.45); background:linear-gradient(180deg,#0f1b33,#0e1729) }
  .btn:hover{ border-color:var(--accent) }
  footer{
    opacity:.8; color:#a1a1aa; font-size:12px; text-align:center; padding:16px 10px 24px;
  }
  .empty{ color:#cbd5e1; text-align:center; grid-column:1/-1; padding:20px 8px; opacity:.9 }
</style>
</head>
<body>

<header>
  <h1>Mes jeux de sciences</h1>
  <p class="sub">Clique sur un jeu pour jouer, ou copie le lien pour le partager aux élèves.</p>
  <div class="toolbar">
    <div class="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.3-4.3M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="q" placeholder="Rechercher un jeu (titre, description)..." />
    </div>
  </div>
</header>

<main class="grid" id="grid">
  <!-- Cartes injectées en JS -->
</main>

<footer>créé par IA • GitHub Pages</footer>

<script>
(async function(){
  const grid = document.getElementById('grid');
  const input = document.getElementById('q');

  // Charge le manifeste
  let games = [];
  try{
    const res = await fetch('games.json', {cache:'no-store'});
    games = await res.json();
  }catch(e){
    grid.innerHTML = '<div class="empty">Impossible de charger <code>games.json</code>. Assure-toi que le fichier existe à la racine du site.</div>';
    return;
  }

  const render = (list)=>{
    if(!list.length){
      grid.innerHTML = '<div class="empty">Aucun jeu ne correspond à ta recherche.</div>';
      return;
    }
    grid.innerHTML = '';
    list.forEach(g=>{
      const card = document.createElement('article');
      card.className = 'card';

      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      if (g.thumb){
        const img = document.createElement('img');
        img.src = g.thumb;
        img.alt = 'Miniature ' + g.title;
        thumb.appendChild(img);
      } else {
        // Fallback : initiales du titre
        const span = document.createElement('span');
        span.textContent = (g.title||'?').trim().slice(0,2).toUpperCase();
        thumb.appendChild(span);
      }

      const body = document.createElement('div');
      body.className = 'body';
      const h3 = document.createElement('h3');
      h3.className = 'title';
      h3.textContent = g.title || g.slug;
      const p = document.createElement('p');
      p.className = 'desc';
      p.textContent = g.desc || '';

      const actions = document.createElement('div');
      actions.className = 'actions';

      // URL absolue vers /slug/
      const gameUrl = new URL(g.slug.replace(/\/?$/,'/') , window.location.href).href;

      const play = document.createElement('a');
      play.className = 'btn primary';
      play.textContent = 'Jouer ▶';
      play.href = gameUrl;
      play.target = '_blank';
      play.rel = 'noopener';

      const copy = document.createElement('button');
      copy.className = 'btn';
      copy.textContent = 'Copier le lien';
      copy.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(gameUrl);
          copy.textContent = 'Lien copié ✅';
          setTimeout(()=> copy.textContent = 'Copier le lien', 1600);
        }catch(e){
          window.prompt('Copie ce lien :', gameUrl);
        }
      });

      actions.append(play, copy);
      body.append(h3, p, actions);
      card.append(thumb, body);
      grid.appendChild(card);
    });
  };

  // Filtrage
  const filter = ()=>{
    const q = (input.value||'').toLowerCase().trim();
    if(!q) return render(games);
    const list = games.filter(g=>{
      const s = (g.title+' '+g.desc+' '+g.slug).toLowerCase();
      return s.includes(q);
    });
    render(list);
  };

  input.addEventListener('input', filter);
  render(games);
})();
</script>
</body>
</html>
